-content_for :widget_title do
  PBC List

-content_for :widget_help, 'cycle_pbclist'

-content_for :widget_buttons do
  -if cycle.pbc_lists.count == 0
    %a.widgetbtn{ :href => new_flow_pbc_list_path(:'pbc_list[audit_cycle_id]' => cycle.id), :'data-toggle' => 'modal-ajax-form', :'data-modal-reset' => 'reset', :'data-form-target' => 'refresh', :'data-modal-class' => 'modal-wide'}
      %i.grcicon-add

-cycle.pbc_lists.each do |pbc_list|
  %h5
    %span=pbc_list.requests.count
    Requests
  %a.item-link{ :href => flow_pbc_list_path(pbc_list.id) }
    -status_counts, status_percentages = pbc_list.request_stats
    .progress.progress-higher
      .bar.bar-danger{:rel => "tooltip", :'data-placement' => "top", :title => "Draft (#{status_counts['Draft']})", :'data-percentage' => status_percentages['Draft']}
      .bar.bar-info{:rel => "tooltip", :'data-placement' => "top", :title => "Waiting Auditors (#{status_counts['Waiting Auditors']})", :'data-percentage' => status_percentages['Waiting Auditors']}
      .bar.bar-warning{:rel => "tooltip", :'data-placement' => "top", :title => "Waiting Compliance (#{status_counts['Waiting Compliance']})", :'data-percentage' => status_percentages['Waiting Compliance']}
      .bar.bar-success{:rel => "tooltip", :'data-placement' => "top", :title => "Completed (#{status_counts['Completed']})", :'data-percentage' => status_percentages['Completed']}

  %a.btn.pull-right{ :href => flow_pbc_list_path(pbc_list.id) }
    View PBC List
    %i.grcicon-arrowright
