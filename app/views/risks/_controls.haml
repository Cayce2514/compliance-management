-# locals: instance

%h3.tab-title
  Controls mitigating this Risk
  %a.widgetbtn.btn.btn-mini.pull-right{ :href => list_edit_flow_control_risks_path(:risk_id => instance.id), :'data-toggle' => 'modal-ajax-relationship-selector', :'data-modal-reset' => 'reset', :'data-list-target' => 'refresh', :rel => 'tooltip', :'data-placement' => 'left', :title => 'Link controls to this risk', :'data-modal-class' => 'modal-wide' }
    %i.grcicon-link-new

%ul.slotlist
  -instance.controls.each_with_index do |control, i|
    -id_prefix = "control-#{i}"
    -summary_toggle_target = "#{id_prefix}-summary"

    %li
      .row-fluid
        .slot.span12.processslot
          .slottitle.span8.toggle{"data-target" => "##{summary_toggle_target}", "data-toggle" => "collapse"}
            .expander
            %span.prefix=control.slug
            =control.title
          -if has_feature? :BETA
            .slotcolumn.span2
              .halfopacity.span12.nominheight.btn.btn-slotcolumn Data Integrity
            .slotowner.span1
              %a.slotowner{:href => "#"} Owner Joe
          -else
            .span3{"data-target" => "##{summary_toggle_target}", "data-toggle" => "collapse"}
          .slotactions.pull-right
            %a.btn.btn-mini.btn-blue.halfopacity{ "data-target" => "##{summary_toggle_target}", "data-toggle" => "collapse", "rel" => "tooltip", "data-placement" => "left", "title" => "More" }
              %i.grcicon-more

      .row-fluid.collapse{ :id => summary_toggle_target }
        .span12.morewell.statusblue.nominheight
          .slotcontent.span12
            %ul.contentactions.pull-right
              %li
                %a.btn.btn-mini.halfopacity{ "rel" => "tooltip", "data-placement" => "left", "title" => "Go to this object's page", :href => flow_control_path(control.id) }
                  %i.grcicon-goto
            =display_as_html control.description

