!!! Strict
%html{:lang => "en", :xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %meta{:content => "text/html; charset=utf-8", "http-equiv" => "Content-Type"}
    %title=@title || "GRC"
    -if has_feature? :BETA
      =stylesheet_link_tag 'design'
      =javascript_include_tag 'design'
      -#
        %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}/
        %meta{:content => "", :name => "description"}/
        %meta{:content => "", :name => "author"}/
        / The HTML5 shim, for IE6-8 support of HTML5 elements
        /[if lt IE 9] <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    -else
      =stylesheet_link_tag 'dashboard'
      =javascript_include_tag 'dashboard'
    =csrf_meta_tag
    %link(href='/favicon.ico' rel='icon' type='image/x-icon')
    
    -#NOTE: This resource occasionally hangs and prevents page from rendering, so loaded after the fact via jquery
    :javascript
      jQuery(function($) { $('head').append("<link href='https://fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'></link>"); });

  %body{ :class => "#{has_feature?(:BETA) ? 'BETA' : ''}" }

    %header.header
      .header-bar
        .container-fluid
          .row-fluid
            .span4
              .logo
                %a{:href => root_path}
                  -if CMS_CONFIG["COMPANY_LOGO"].present?
                    =image_tag(CMS_CONFIG['COMPANY_LOGO'], :alt => 'GRC', :title => 'GRC')
                  -elsif has_feature? :BETA
                    =image_tag('/images/logos/logo.png')
                  -else
                    Google GRC                
            .span8
              %ul.menu    
                %li.demo
                  -if controller_name == 'design'
                    -path = programs_dash_path
                  -else
                    -path = request.fullpath                
                  -path = path.gsub(/BETA=[^&]*&?/, '').sub(/[?&]$/, '')
                  -path += path.include?('?') ? '&' : '?'
                  -if has_feature? :BETA
                    %a.demo-hide{ :href => "#{path}BETA=0" }
                      %i.grcicon-demo
                      Hide Demo
                  -else
                    %a.demo-show{ :href => "#{path}BETA=1" }
                      %i.grcicon-demo
                      Show Demo

                  %li{:class => "#{controller.controller_name != 'programs_dash' ? '' : 'active'}"}
                    %a{:href => programs_dash_path}
                      %i.grcicon-dashboard
                      Dashboard
                  -help_path = yield(:page_help)
                  -if !help_path.blank?
                    %li
                      %a{:href => "/help/#{help_path}", :'data-toggle' => 'modal-ajax'}
                        %i.grcicon-help
                        Help
                  =yield :header_buttons
                %li.user.dropdown
                  %a{:href => "#", :class => "dropdown-toggle", :'data-toggle' =>"dropdown", :role =>"button"}
                    %i.grcicon-user
                    %strong=current_user.name || current_user.email
                  %ul.dropdown-menu{:'aria-labelledby' => 'drop1', :role =>"menu"}
                    %li
                      %a{:href =>logout_path, :tabindex =>"-1"}
                        %i.grcicon-logout
                        Logout
                %li.screen.dropdown
                  %a{:href => "#", :class => "dropdown-toggle screen-size", :'data-toggle' =>"dropdown", :role =>"button"}
                    %i.grcicon-desktop
                    %span
                      100%
                  %ul.dropdown-menu{:'aria-labelledby' => 'drop2', :role =>"menu"}
                    %li.full-view
                      %a{:href =>'#', :tabindex =>"-1"}
                        %i.grcicon-wide
                        100%
                    %li.wide-view
                      %a{:href =>'#', :tabindex =>"-1"}
                        %i.grcicon-wide
                        Wide
                    %li.narrow-view
                      %a{:href =>'#', :tabindex =>"-1"}
                        %i.grcicon-normal
                        Narrow
            
      .header-content
        .container-fluid
          .row-fluid
            .span6
              =yield :header
            .span6
              =yield :subheader_extras
              

    -#.navbar
      .navbar-inner#pageheader
        .row-static.container
          .headerleft
          -#-if has_feature? :BETA
            -if controller.controller_name == 'programs_dash'
              .headercenter.fltnone
                =render :partial => 'design/templates/grcmenu'
          .headerright
            -#.btn-toolbar.fltrt.toolbar-nav
              .btn-group
                -if controller_name == 'design'
                  -path = programs_dash_path
                -else
                  -path = request.fullpath                
                -path = path.gsub(/BETA=[^&]*&?/, '').sub(/[?&]$/, '')
                -path += path.include?('?') ? '&' : '?'
                -if has_feature? :BETA
                  %a.btn.btn-warning{ :href => "#{path}BETA=0" } Hide Demo
                -else
                  %a.btn.btn-success{ :href => "#{path}BETA=1" } Show Demo
              
    =yield :subheader_plus

    %section.content
      .flash!=[:error, :warning, :notice].map { |type| content_tag(:div, flash[type], :class => type) if flash[type] }.join
      =yield

    %section.footer
      .container-fluid
        .row-fluid
          %span12
            %p
              =CMS_CONFIG['COMPANY']
              Confidential.
              Copyright &copy;
              =Time.now.year
              =CMS_CONFIG['COMPANY']
            
    -#.gcms-footer
      .block
        %p
          =CMS_CONFIG['COMPANY']
          Confidential.
          Copyright &copy;
          =Time.now.year
          =CMS_CONFIG['COMPANY']

    #templates
      #help-modal.modal.hide.fade
        .modal-header
          %a.close{"data-dismiss" => "modal"} x
          %h1 This content/function is coming soon
        .modal-body
          %p We are working on it!
        .modal-footer
          %a.close.btn.btn-large.btn-primary{"data-dismiss" => "modal", :href => "#"} Close

      #comingsoon-modal.modal.hide.fade
        .modal-header
          %a.close{"data-dismiss" => "modal"} x
          %h1 This content/function is coming soon
        .modal-body
          %p We are working on it!
        .modal-footer
          %a.close.btn.btn-large.btn-primary{"data-dismiss" => "modal", :href => "#"} Close
