-@title = "GRC Reg Mapper for: #{@program.title}"

-content_for :header do
  %ul.breadcrumbs
    %li=link_to 'Programs', programs_dash_path
    %li=link_to @program.title, flow_program_path(@program)
    %li
      Mapping

  %h1
    %span
      Regulation to Control Mapping:
    =@program.title

-content_for :page_help, 'mapping'

.container-fluid.reg-mapper
  #mapping_columns.row-fluid{ :'data-resize' => "true" }
    .span4
      #section_list
        =render :partial => 'section_list',
                :layout => 'layouts/widget_box',
                :locals => { :sections => @program.sections.includes(:parent, :controls => :implementing_controls) }

      =render :partial => 'selected_section',
              :layout => 'layouts/widget_box',
              :locals => {:section => nil}
    .span4
      #rcontrol_list
        =render :partial => 'control_list',
                :layout => 'layouts/widget_box',
                :locals => { :controls => @rcontrols, :title_prefix => 'Reg', :program => @program, :control_type => 'regulation' }

      =render :partial => 'selected_control',
              :layout => 'layouts/widget_box',
              :locals => {:control => nil, :control_type => 'rcontrol', :map_button_id => :cmap, :map_button_path => mapping_map_ccontrol_path }

    .span4
      #ccontrol_list
        =render :partial => 'control_list',
                :layout => 'layouts/widget_box',
                :locals => { :controls => @ccontrols, :title_prefix => 'Company', :program => @program, :control_type => 'company' }

      =render :partial => 'selected_control',
              :layout => 'layouts/widget_box',
              :locals => {:control => nil, :control_type => 'ccontrol', :map_button_id => nil }

  :javascript
    $(document).ready(function(){
      init_mapping();
    });
    function update_map_buttons() {
      //update_map_buttons_with_path('#{mapping_buttons_path(:format => "json")}');
    }
